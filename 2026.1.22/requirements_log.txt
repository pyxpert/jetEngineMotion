================================================================================
双节机器人运动规划系统 - 需求记录文档
================================================================================
创建时间: 2024
最后更新: 当前会话

本文档记录用户在开发过程中提出的所有需求，作为开发和迭代的依据。

================================================================================
一、机器人结构需求
================================================================================

1. 机器人基本结构
   - 双节机器人，分为前后两节
   - 前后两节上表面都为长方形
   - 初始位置时两节上表面共面
   - 两节之间可发生相对位移和单轴旋转运动

2. 机器人尺寸参数
   - 前节长×宽: L1=40mm × W1=30mm
   - 后节长×宽: L2=40mm × W2=30mm  
   - 电磁铁底面到上表面高度: h=30mm
   - 直线电机最大行程: s_max=8mm
   - 电磁铁直径: 5mm（半径2.5mm）

3. 电机配置
   - ω1: 前节中心旋转电机，控制前节电磁铁相对于前节的角度
   - ω2: 后节中心旋转电机，控制后节电磁铁相对于后节的角度
   - ω3: 两节间旋转电机，控制两节相对角度
   - v: 丝杠电机，控制两节间相对位移

4. 电磁铁配置
   - 每节中心有一个圆柱形电磁铁
   - 吸力面在圆柱底面
   - 电磁铁与旋转电机同轴
   - 电磁铁轴线与所在节上表面垂直

5. 电机位置范围
   - θ1 (ω1电机): -360° 到 +360°
   - θ2 (ω2电机): -360° 到 +360°
   - θ3 (ω3电机): -90° 到 +90°（0°为两节共面）
   - s (v电机): 0mm 到 8mm

================================================================================
二、运动约束需求
================================================================================

1. 电磁铁状态约束
   - 两个电磁铁都ON时：所有电机必须停止（机器人固定）
   - 两个电磁铁不能同时OFF（安全考虑，防止机器人滑落）

2. 电机运动约束
   - 一个电磁铁OFF、一个ON时：
     * OFF的节可以移动（通过ω3、v）
     * ON的节可以相对于其电磁铁旋转（通过ω1或ω2）
     * OFF节的ω电机也可以旋转，用于避免角度累积超出±360°范围
       （注：用户修正了之前"OFF节ω电机旋转无意义"的说法）

3. ω3旋转轴位置
   - ω3旋转轴始终与前后两节上表面的交线共线
   - 当ω3旋转时，两节呈"折叠"状态，后节上表面会倾斜

================================================================================
三、环境模型需求
================================================================================

1. 航空发动机/燃气轮机内腔
   - 圆柱形内壁
   - 内表面半径: 900mm（恒定）
   - 圆柱内壁总长度: 1000mm（Z轴范围0-1000mm）

2. 叶片障碍物
   - 共四级叶片
   - 分布位置: 200mm、400mm、600mm、800mm
   - 叶片不可攀爬，视为障碍物
   - 叶片之间有通道可供机器人通过

================================================================================
四、初始/终止状态需求
================================================================================

1. 机器人初始位置（3D坐标）
   - 前足起始点: X=0, Y=-900, Z=40 mm
   - 后足起始点: X=0, Y=-900, Z=0 mm
   - 双足皆处于圆柱内壁最底端

2. 机器人初始状态
   - 各电机初始位置都为0
   - 直线电机行程为0
   - 机器人朝向：后足指向前足的方向为Z减小的方向

3. 机器人终止位置
   - 前足终点: X=0, Y=-900, Z=1000 mm
   - 前足到达终点后即视为运动过程结束（不需要后足也到达终点）

4. 前后足位置关系
   - 前后足在物理上不能处于同一位置
   - 初始时前足Z=40mm，后足Z=0mm，两者相距40mm
   - 运动过程中前后足始终保持一定距离

================================================================================
五、输出格式需求
================================================================================

1. 状态码格式
   - 六位状态数组: ω1ω2ω3vm1m2
   - 旋转电机和丝杠电机：0=停止, 1=正转, 2=反转
   - 电磁铁：0=脱附(OFF), 1=吸附(ON)
   - 配合持续时间t

2. 输出文件要求
   - JSON格式文件
   - 制表符分隔的文本文档（表格形式）

3. 表格内容要求
   - 每一步运动完成后记录各电机位置
   - θ1: 前节旋转电机角度
   - θ2: 后节旋转电机角度
   - θ3: 中间旋转电机角度
   - s: 直线电机行程
   - 包含初始状态和最终汇总信息
   - 显示位置警告（接近极限时）

================================================================================
六、可视化需求
================================================================================

1. 发动机腔体可视化
   - 水平放置（躺下来），口朝水平方向
   - 机器人轨迹在内腔表面
   - 叶片在发动机内部，向内延伸

2. 机器人结构可视化
   - 生成机器人结构示意图
   - 能够看到电磁铁的圆柱特征（直径5mm）
   - 电磁铁轴线与上表面垂直

3. 特定状态可视化
   - 初始状态: θ3=0°, s=0mm
   - 状态1: θ3=+45°, s=0mm
   - 状态2: θ3=-45°, s=s_max(8mm)
   - 状态3: θ3=90°, s=0mm
   - 状态4: s=s_max, θ3=0°

4. 交互式3D可视化
   - 弹出窗口形式显示
   - 支持鼠标旋转、缩放查看
   - 不仅保存到文件

5. 轨迹可视化
   - 前足轨迹和后足轨迹用不同颜色区分
   - 叶片图例只标注一个（避免重复）

6. 电磁铁可视化细节
   - 仅θ3=0°时两个电磁铁底面共面
   - θ3旋转时，电磁铁轴线始终垂直于其所在节的上表面

7. 3D图像比例尺要求
   - 各轴(X, Y, Z)的比例尺必须一致
   - 不要为了使整个图像呈正方体而修改各轴比例尺
   - 保持真实的几何比例关系

================================================================================
七、技术实现需求
================================================================================

1. 解决导入问题
   - matplotlib和mpl_toolkits.mplot3d的导入错误
   - 通过pip install matplotlib numpy解决

2. 解决中文显示问题
   - 图像中的方框/乱码问题
   - 改用英文标签

3. 坐标系统
   - 支持3D笛卡尔坐标和圆柱面坐标转换
   - X, Y为径向坐标
   - Z为轴向坐标

================================================================================
八、需求变更记录
================================================================================

1. [变更] "OFF节ω电机旋转无意义"
   - 原始理解：OFF节的ω电机旋转是无意义的空转
   - 用户修正：OFF节的ω电机可以旋转，用于避免旋转角度超出±360°范围

2. [变更] 圆柱内壁长度
   - 原始：100mm
   - 修改为：1000mm

3. [变更] 叶片分布
   - 原始：自动生成
   - 修改为：四级，位于200mm、400mm、600mm、800mm

4. [修正] 前后足起始位置
   - 错误：前后足起始位置被设置为同一点（物理上不可能）
   - 修正：前足起始Z=40mm，后足起始Z=0mm，两者相距40mm
   - 前后足在物理上始终保持一定距离

5. [明确] 运动结束条件
   - 前足到达终点(Z=1000mm)后即视为运动过程结束
   - 不需要后足也到达终点位置

6. [修正] 蠕虫式爬行算法
   - 问题：原算法每步只生成一个丝杠动作，导致机器人无法到达目标
   - 修正：实现完整的蠕虫式爬行周期
     * 前节吸附(m1=1) + 丝杠伸出(v=1)：后节Z增大
     * 后节吸附(m2=1) + 丝杠缩回(v=2)：前节Z增大
     * 多个周期交替执行，实现长距离移动

7. [修正] 可视化中前后足起点/终点位置
   - 问题：起点/终点未正确显示在圆柱底部Y=-900mm处
   - 修正：可视化函数正确传入并使用前后足的起始Z坐标和目标Z坐标

8. [移除] Motion State Sequence图
   - 图表混乱且无实用价值，不再生成

9. [修正] 叶片障碍物的避障逻辑
   - 问题：原规划未考虑叶片作为真实障碍物，机器人直接穿过叶片区域
   - 明确：叶片高度远大于机器人高度，机器人两足不可能跨过叶片所在区域
   - 修正：机器人必须在周向上绕过叶片，不能直接轴向穿过

================================================================================
文档说明
================================================================================

此文档将在用户提出新需求时持续更新，作为开发迭代的参考依据。

每次更新时会：
1. 添加新的需求到相应分类
2. 记录需求变更（如有）
3. 更新时间戳

================================================================================
